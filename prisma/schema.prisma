// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
  // url      = "postgres://default:Akym1JnOVP9z@ep-soft-mode-76400388.us-east-1.postgres.vercel-storage.com:5432/verceldbstaging"  //Staging
  // url      = "postgres://default:Akym1JnOVP9z@ep-soft-mode-76400388.us-east-1.postgres.vercel-storage.com:5432/verceldb"      //Live
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

model Role {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  is_deleted Boolean @default(false)

  created_at DateTime    @default(now())
  updated_at DateTime    @default(now())
  User       AdminUser[]

  @@map("role")
}

model Setting {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  lang_id    String       @db.ObjectId
  group      SettingEnums @default(BANNER)
  key        String
  value      String
  is_deleted Boolean      @default(false)
  is_enabled Boolean      @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  SettingDescription SettingDescription[]

  @@index([lang_id])
  @@map("setting")
}

model SettingDescription {
  id         String       @id @default(auto()) @map("_id") @db.ObjectId
  setting_id String       @db.ObjectId
  group      SettingEnums @default(BANNER)
  key        String
  value      String
  lang_id    String       @db.ObjectId
  is_deleted Boolean      @default(false)
  created_at DateTime     @default(now())
  updated_at DateTime     @default(now())
  Setting    Setting      @relation(fields: [setting_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([setting_id, lang_id])
  @@map("setting_desc")
}

model AdminUser {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  password   String
  email      String  @unique
  role_id    String  @db.ObjectId
  is_deleted Boolean @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Role Role @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  Post     Category[]
  Projects Projects[]

  @@index([role_id])
  @@map("admin_user")
}

model CouponApply {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  customer_id   String   @db.ObjectId
  cart_id       String   @db.ObjectId
  coupon_id     String   @db.ObjectId
  discount      String   @db.ObjectId
  is_used       Boolean  @default(false)
  is_percentage Boolean  @default(false)
  is_deleted    Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now())
  Customer      Customer @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Cart          Cart     @relation(fields: [cart_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([customer_id, cart_id, coupon_id])
  @@map("coupon_apply")
}

model Category {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  thumb      String
  user_id    String   @db.ObjectId
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  User     AdminUser  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Projects Projects[]

  @@index([user_id])
  @@map("category")
}

model Projects {
  id                 String       @id @default(auto()) @map("_id") @db.ObjectId
  name               String
  desc               String
  thumb              String?
  material_type      MaterialType @default(dump)
  price              Int
  total_rounds       Int
  meta               String?
  is_cash_alt        Boolean      @default(false)
  is_enabled         Boolean      @default(false)
  is_featured        Boolean      @default(false)
  user_id            String       @db.ObjectId
  launch_date        DateTime     @default(now())
  end_date           DateTime     @default(now())
  draw_date          DateTime?
  created_at         DateTime     @default(now())
  updated_at         DateTime     @default(now())
  is_deleted         Boolean      @default(false)
  is_winner_selected Boolean      @default(false)

  User AdminUser @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  CartItem     CartItem[]
  EventImages  EventImage[]
  EventTickets EventTickets[]
  Category     Category?      @relation(fields: [categoryId], references: [id])
  categoryId   String?        @db.ObjectId

  @@index([user_id])
  @@map("Project")
}

model EventImage {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  thumb      String
  project_id String  @db.ObjectId
  is_deleted Boolean @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Projects Projects @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([project_id])
  @@map("event_image")
}

model Customer {
  id              String            @id @default(auto()) @map("_id") @db.ObjectId
  email           String
  username        String?           @default("")
  password        String
  is_approved     Boolean           @default(false)
  otp             String            @default("")
  first_name      String?
  profile_pic     String?
  last_name       String?
  phone_number    String?
  country         String?
  gender          GenderEnums       @default(male)
  dob             DateTime?
  is_deleted      Boolean           @default(false)
  is_blocked      Boolean           @default(false)
  is_verified     Boolean           @default(false)
  is_disabled     Boolean           @default(false)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @default(now())
  Order           Order[]
  CustomerAddress CustomerAddress[]

  Cart          Cart[]
  CouponApply   CouponApply[]
  DeleteRequest DeleteRequest[]

  EventTickets EventTickets[]

  @@map("customer")
}

model DeleteRequest {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  customer_id String   @db.ObjectId
  reason      String?
  comment     String?
  is_deleted  Boolean? @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @default(now())
  Customer    Customer @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([customer_id])
  @@map("delete_request")
}

model CustomerAddress {
  id               String      @id @default(auto()) @map("_id") @db.ObjectId
  customer_id      String      @db.ObjectId
  street_address_1 String?
  street_address_2 String?
  country          String?
  state            String?
  city             String?
  phone_number     String?
  phone_code       String?     @default("+971")
  address_type     AddressType @default(home)
  postal_code      String?     @default("")
  is_default       Boolean     @default(false)
  is_deleted       Boolean     @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Customer Customer @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([customer_id])
  @@map("customer_address")
}

model Cart {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  customer_id String  @db.ObjectId
  is_deleted  Boolean @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Customer    Customer      @relation(fields: [customer_id], references: [id])
  CartItems   CartItem[]
  CouponApply CouponApply[]

  @@index([customer_id])
  @@map("cart")
}

model CartItem {
  id                String             @id @default(auto()) @map("_id") @db.ObjectId
  cart_id           String             @db.ObjectId
  project_id        String             @db.ObjectId
  quantity          String             @db.ObjectId
  is_subscribe      Boolean            @default(false)
  subscription_type SubscriptionEnums?
  is_deleted        Boolean            @default(false)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Cart     Cart     @relation(fields: [cart_id], references: [id])
  Projects Projects @relation(fields: [project_id], references: [id])

  @@index([cart_id, project_id])
  @@map("cart_item")
}

model Order {
  id               String     @id @default(auto()) @map("_id") @db.ObjectId
  sub_total_amount Float
  discount_amount  Float
  total_amount     Float
  status           OrderEnums @default(pending)
  first_name       String
  parent_order_id  String?    @db.ObjectId
  customer_id      String     @db.ObjectId
  total_payment_id String
  last_name        String
  email            String
  dob              DateTime
  street_address   String
  apartment        String?
  country          String
  state            String
  city             String
  phone_number     String
  postal_code      String
  is_deleted       Boolean    @default(false)

  Customer    Customer @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ParentOrder Order?   @relation(name: "ParentOrder", fields: [parent_order_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  Order Order[] @relation("ParentOrder")

  @@index([customer_id])
  @@map("order")
}

model EventTickets {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  ticket_num  Int
  project_id  String  @db.ObjectId
  customer_id String? @db.ObjectId
  is_winner   Boolean @default(false)
  is_deleted  Boolean @default(false)

  Projects Projects  @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  Customer Customer? @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  created_at DateTime @default(now())
  updated_at DateTime @default(now())

  @@index([customer_id, project_id])
  @@map("event_ticket")
}

enum MaterialType {
  dump
  sand
}

enum SettingEnums {
  BANNER
  WONDER
  PAYMENT
  IMAGE_GALLERY
  CONFIG
}

enum LanguageEnums {
  rtl
  ltr
}

enum SubscriptionEnums {
  weekly
  monthly
  quarterly
}

enum GenderEnums {
  male
  female
}

enum CMSEnums {
  EventFAQs
  faqs
  static
  event_faqs
}

enum AddressType {
  home
  work
  hotel
  other
}

enum OrderEnums {
  pending
  paid
  rejected
}

enum CouponEnums {
  percentage
  fixed
}

// Tables

// Front tables
//1- Customers
//2- Categories
//3- Charity
//3- Events
//3- Event Images
//3- Events FAQs 
//4- Orders
//4- Orders Details
//5- Coupons

// Admin tables
//7- Users
//8- Roles
//9- Resource
//10- Roles Permissions
//11- Settings?
//12- CMS
//6- FAQs
